(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[485],{7705:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/timesheet",function(){return r(287)}])},287:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__N_SSP:()=>d,default:()=>l});var a=r(5893),n=r(7294),o=r(3299),d=!0;function l(){let[e,t]=(0,n.useState)("notStarted"),{data:r}=(0,o.useSession)(),[d,l]=(0,n.useState)(null),[s,c]=(0,n.useState)([]);(0,n.useEffect)(()=>{var e;(null==r?void 0:null===(e=r.user)||void 0===e?void 0:e.id)&&i(r.user.id)},[r]);let i=async e=>{let t=await fetch("/api/timesheet/".concat(e),{method:"GET"}),r=await t.json();l(r.current||null),c(r.all||[]),u(r.current)},u=e=>{e?e.timeOut?t("clockedOut"):e.breakStart&&!e.breakEnd?t("onBreak"):t("clockedIn"):t("notStarted")},m=async e=>{var t;if(!(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id))return;let a=await fetch("/api/timesheet/".concat(r.user.id),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})}),n=await a.json();a.ok?(l(n),u(n)):alert(n.error||"Failed to update timesheet")},h=(e,t)=>{let r={hour:"numeric",minute:"numeric",second:"numeric",hour12:!0},a=new Date(e).toLocaleTimeString("en-SG",r),n=t?new Date(t).toLocaleTimeString("en-SG",r):"In Progress";return"".concat(a," - ").concat(n)},b=e=>{let t=Math.floor(e/1e3),r=Math.floor(t/3600),a=Math.floor(t%3600/60);return"".concat(r,"h ").concat(a,"m ").concat(t%60,"s")};return(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Timesheet"}),(0,a.jsxs)("table",{className:"min-w-full border-collapse border border-gray-200 mt-6",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border border-gray-300 p-2",children:"Employee Name"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2",children:"Date"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2",children:"Duration"}),(0,a.jsx)("th",{className:"border border-gray-300 p-2",children:"Time Span"})]})}),(0,a.jsx)("tbody",{children:s.length>0?s.map(e=>{var t,n;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:"".concat(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.firstName," ").concat(null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.lastName)}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:new Date(e.timeIn).toLocaleDateString("en-SG")}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:e.timeOut?b(new Date(e.timeOut)-new Date(e.timeIn)):"In Progress"}),(0,a.jsx)("td",{className:"border border-gray-300 p-2",children:h(e.timeIn,e.timeOut)})]},e.id)}):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"4",className:"border border-gray-300 p-2 text-center",children:"No timesheets found."})})})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-4",children:[(0,a.jsx)("button",{onClick:()=>m("timeIn"),className:"py-2 px-4 rounded ".concat("clockedIn"===e||"clockedOut"===e?"bg-gray-400 cursor-not-allowed":"bg-green-500 text-white"),disabled:"clockedIn"===e||"clockedOut"===e,children:"Time In"}),(0,a.jsx)("button",{onClick:()=>m("onBreak"===e?"breakEnd":"breakStart"),className:"bg-yellow-500 text-white py-2 px-4 rounded",disabled:"notStarted"===e||"clockedOut"===e,children:"onBreak"===e?"End Break":"Start Break"}),(0,a.jsx)("button",{onClick:()=>m("timeOut"),className:"bg-red-500 text-white py-2 px-4 rounded",disabled:"clockedIn"!==e,children:"Time Out"})]}),"clockedOut"===e&&(0,a.jsx)("p",{className:"mt-4 text-red-500",children:"You have clocked out for today."})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[888,774,179],()=>t(7705)),_N_E=e.O()}]);